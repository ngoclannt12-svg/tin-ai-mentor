<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>TIN-AI Mentor - B·∫£n S·ª≠a L·ªói Tri·ªát ƒê·ªÉ</title>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --blue-600:#2563eb; --blue-700:#1d4ed8; --slate-100:#f1f5f9; --white:#ffffff; --orange: #ff6b3d; }
    body { margin: 0; font-family: "Be Vietnam Pro", sans-serif; background: var(--slate-100); }
    .container { width: min(1100px, calc(100% - 40px)); margin: 0 auto; padding: 20px 0; }
    .card { background: var(--white); padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .btn { padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; background: var(--blue-600); color: white; width: 100%; margin-top: 15px; }
    .option { display: block; padding: 10px 15px; border: 1px solid #eee; border-radius: 10px; margin-top: 8px; cursor: pointer; }
    .option.selected { background: #e0f2fe; border-color: var(--blue-600); font-weight: 600; }
    #quiz-section, #result-section { display: none; }
    .ai-feedback { border-left: 5px solid var(--orange); background: #fffcf9; padding: 20px; border-radius: 0 15px 15px 0; line-height: 1.8; min-height: 100px; }
    pre { background: #2d2d2d; color: #61dafb; padding: 15px; border-radius: 8px; overflow-x: auto; font-family: 'Courier New', monospace; }
  </style>
</head>
<body>
  <div class="container">
    <div id="setup-section" class="card">
      <h2>üöÄ TIN-AI Mentor: H·ªá th·ªëng Adaptive Learning</h2>
      <input type="text" id="student-name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd;">
      <select id="topic" style="width:100%; padding:12px; margin-top:10px; border-radius:10px;">
        <option value="Bi·∫øn v√† ki·ªÉu d·ªØ li·ªáu">Bi·∫øn v√† Ki·ªÉu d·ªØ li·ªáu</option>
        <option value="C·∫•u tr√∫c r·∫Ω nh√°nh if-else">C·∫•u tr√∫c r·∫Ω nh√°nh</option>
        <option value="V√≤ng l·∫∑p for v√† while">V√≤ng l·∫∑p</option>
      </select>
      <button class="btn" onclick="startQuiz()">B·∫Øt ƒë·∫ßu l√†m b√†i (AI sinh ƒë·ªÅ m·ªõi)</button>
    </div>

    <div id="quiz-section">
      <div class="card"><h3>C√¢u h·ªèi t·ª´ AI:</h3><div id="quiz-content"></div></div>
      <button class="btn" onclick="submitQuiz()">N·ªôp b√†i & Ph√¢n t√≠ch AI</button>
    </div>

    <div id="result-section">
      <div class="grid">
        <div class="card"><h3>NƒÉng l·ª±c th·ª±c t·∫ø</h3><canvas id="radarChart"></canvas><h2 id="final-score" style="text-align:center;"></h2></div>
        <div class="card"><h3>ü§ñ Nh·∫≠n x√©t chi ti·∫øt t·ª´ng c√¢u</h3><div id="ai-feedback" class="ai-feedback"></div><button class="btn" onclick="location.reload()">L√†m ƒë·ªÅ kh√°c</button></div>
      </div>
    </div>
  </div>

  <script>
    const GEMINI_API_KEY = "AIzaSyDNK-HQezg7B1GjYMDPfkHx7Ig2_lKaYEA"; // H√£y th·ª≠ ƒë·ªïi Key n·∫øu v·∫´n l·ªói
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
    
    let currentQuestions = [];
    let studentName = "";

    async function startQuiz() {
      studentName = document.getElementById('student-name').value;
      if(!studentName) return alert("Vui l√≤ng nh·∫≠p t√™n!");
      document.getElementById('setup-section').style.display = 'none';
      document.getElementById('quiz-section').style.display = 'block';
      document.getElementById('quiz-content').innerHTML = "‚è≥ AI ƒëang so·∫°n ƒë·ªÅ thi m·ªõi (12 c√¢u)...";

      const prompt = `T·∫°o 12 c√¢u h·ªèi tr·∫Øc nghi·ªám Python kh√°c nhau v·ªÅ ${document.getElementById('topic').value}. 
      C·∫•u tr√∫c JSON: [{"q":"c√¢u h·ªèi","o":["A","B","C","D"],"a":0,"l":"nb"}] (a l√† index ƒë√∫ng, l l√† m·ª©c ƒë·ªô nb/th/vd).`;

      try {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
        const data = await res.json();
        const rawText = data.candidates[0].content.parts[0].text;
        currentQuestions = JSON.parse(rawText.substring(rawText.indexOf("["), rawText.lastIndexOf("]") + 1));
        renderQuiz();
      } catch (e) {
        alert("L·ªói k·∫øt n·ªëi AI. ƒêang d√πng ƒë·ªÅ d·ª± ph√≤ng.");
        currentQuestions = [
            {q:"L·ªánh n√†o d√πng ƒë·ªÉ in?", o:["print","input","if","for"], a:0, l:"nb"},
            {q:"10 % 3 b·∫±ng m·∫•y?", o:["1","3","0","3.3"], a:0, l:"nb"}
            // ... th√™m c√¢u kh√°c
        ];
        renderQuiz();
      }
    }

    function renderQuiz() {
      const content = document.getElementById('quiz-content');
      content.innerHTML = currentQuestions.map((item, i) => `
        <div style="margin-bottom:20px;">
          <p><b>C√¢u ${i+1}:</b> ${item.q}</p>
          ${item.o.map((opt, oi) => `<label class="option" id="q${i}o${oi}"><input type="radio" name="q${i}" value="${oi}" style="display:none" onclick="selectOpt(${i},${oi})"> ${opt}</label>`).join('')}
        </div>
      `).join('');
    }

    function selectOpt(qI, oI) {
      document.querySelectorAll(`[id^="q${qI}o"]`).forEach(el => el.classList.remove('selected'));
      document.getElementById(`q${qI}o${oI}`).classList.add('selected');
    }

    async function submitQuiz() {
      let score = 0; let wrongs = []; let stats = {nb:0, th:0, vd:0};
      currentQuestions.forEach((item, i) => {
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        if(sel && parseInt(sel.value) === item.a) { score++; stats[item.l]++; }
        else { wrongs.push({ q: item.q, user: sel ? item.o[sel.value] : "B·ªè tr·ªëng" }); }
      });

      document.getElementById('quiz-section').style.display = 'none';
      document.getElementById('result-section').style.display = 'block';
      document.getElementById('final-score').innerText = `K·∫øt qu·∫£: ${score}/12`;
      
      renderRadarChart(stats);
      
      // G·ªåI AI NH·∫¨N X√âT CHI TI·∫æT
      const fb = document.getElementById('ai-feedback');
      fb.innerHTML = "<em>ü§ñ AI ƒëang ph√¢n t√≠ch l·ªói sai c·ªßa b·∫°n...</em>";
      try {
        const promptFB = `H·ªçc sinh ${studentName} sai c√°c c√¢u: ${JSON.stringify(wrongs)}. ƒêi·ªÉm ${score}/12. 
        H√£y gi·∫£i th√≠ch C·ª§ TH·ªÇ t·ª´ng c√¢u sai t·∫°i sao sai v√† g·ª£i √Ω t∆∞ duy b·∫±ng HTML (b, li, pre). Kh√¥ng cho ƒë√°p √°n ƒë√∫ng.`;
        const resFB = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: promptFB }] }] }) });
        const dataFB = await resFB.json();
        fb.innerHTML = dataFB.candidates[0].content.parts[0].text.replace(/```html|```/g, "");
      } catch { fb.innerHTML = "AI kh√¥ng th·ªÉ nh·∫≠n x√©t l√∫c n√†y. H√£y xem l·∫°i b√†i t·∫≠p!"; }
    }

    function renderRadarChart(stats) {
      new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: { labels: ['Nh·∫≠n bi·∫øt', 'Th√¥ng hi·ªÉu', 'V·∫≠n d·ª•ng'], datasets: [{ label: 'ƒê√∫ng', data: [stats.nb||0, stats.th||0, stats.vd||0], borderColor: '#2563eb', fill: true }] },
        options: { scales: { r: { beginAtZero: true, max: 4 } } }
      });
    }
  </script>
</body>
</html>
